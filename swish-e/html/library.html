<html>
<head>
<title>SWISH-E 2 library</title>
</head>
<body bgcolor="ivory">
<center>
<h1>Swish-2.1.X search library</h1>
<h2>Why using a library</h2>
</center>
The search component of swish-e 2.1.X is built in the top of a C library. I have a made a thread
safe library to simplify the way of accessing index files and to give other people an easy way to implement other
packages like:<br>
- A <a href="perl.html">perl module</a><br>
- A <a href="php.html">php extension</a><br>
- CGi scripts<br>
<br>
In swish-e-2.1.X package, a simple but functional <a href="perl.html">perl module</a> is included. It has been built on the top of the C library
<p>
<p>

<center>
<h2>How to build the library</h2>
</center>
The library is built at the same time swish-e. In fact, you cannot build swish-e without it.<br>
As a general rule, in the src directory, type:<br>
<pre>
./configure
make
</pre>
In the src directory, there must be a libswish-e.a file. Copy this file to your library directory, usually /usr/local/lib or /usr/lib (probably you must be root to do this). If you type:<br>
make install
</pre>
the cp command will be issued for you.
<p>
<p>

<center>
<h2>Functions of the library</h2>
</center>

<h3>struct SWISH *SwishOpen(char *IndexFiles);</h3>
This function opens one or more index files and returns a handle to them.<br>
<font size=-1>Eg:  handle=SwishOpen("index_file.idx");</font><br>
If you want to search in more than one index file, use spaces to separate them.<br>
<font size=-1>Eg:  handle=SwishOpen("index1.idx index2.idx");</font><br>
<p>

<h3>void SwishClose(struct SWISH *handle)</h3>
Closes the handle returned by SwishOpen. This function closes all the opened files and frees the used memory.<br>
<p>

<h3>int SwishSearch(struct SWISH *handle,char *words,int structure,char *properties,char *sortspec)</h3>
This function parses a search and returns the number of hits or a negative value on error<br>
The values passed are:<br>
<i>handle</i> is the handle returned by SwishOpen<br>
<i>words</i> is the search string. Eg: title="this a is phrase"<br>
<i>structure</i> is an integer value only applicable for an html search. It can be IN_FILE, IN_TITLE, IN_HEAD, IN_BODY, IN_COMMENTS, IN_HEADER or IN_EMPHASIZED or "ored" combinatios of them (eg: IN_HEAD | IN_BODY). Use IN_FILE if your documents are not html.<br>
<i>properties</i> is a string with the properties to be returned separated by spaces<br>
<i>sortspec</i> is the sort spec if different from relevance. Eg: title asc otherfield desc anotherfiled desc<br>
<br>
<font size =-1>Eg: num_results=SwishSearch(handle,"metaname=\"this is a phrase\" or otherword",IN_FILE,"name depno","depno asc");</font><bt>
<p>


<h3>struct result *SwishNext(struct SWISH *handle)</h3>
This function returns the next hit of a search. Must be executed after SwishSearch to read the results.<br>
Eg:<br>
numPropertiesToDisplay=getnumPropertiesToDisplay(sw);<br>
while(r=SwishNext(sw))<br>
{<br>
   printf("%d %s \"%s\" %d %d",r->rank,r->filename,r->title,r->start,r->size);<br>
   for(j=0;j&lt;numPropertiesToDisplay;j++) printf(" \"%s\"",r->Prop[j]);<br>
   printf("\n");<br>
}<br>
<p>

<h3>int getnumPropertiesToDisplay(struct SWISH *handle)</h3>
This function can be used to get the number of properties to be get from the results.<br>
See SwishNext for a sample<br>
<p>

<h3>int SwishSeek(struct SWISH *handle, int num)</h3>
Repositions the pointer in the result list to the element pointed by num. It is useful when you want to read only the results starting at num<br>
<p>

<h3>int SwishError(struct SWISH *handle)</h3>
Returns the last error if any (always a negative value). If there is not an error it will return 0<br>
<p>

<h3>char *SwishHeaderParameter(struct indexfile *indexf,char *HeaderParameterName)</h3>
This function is useful to access the header data of the index files<br>
Returns the contents of the requested header parameter of an index file opend by SwishOpen. You should use this function inside a bucle.<br>
<pre>
Eg:
struct indexfile *my_indexlist;
my_indexlist=handle->indexlist;
while(my_indexlist)
{
    print("%s\n",SwishHeaderParameter(my_indexlist,"WordCharacters"));
    my_indexlist=my_indexlist->next:
}
</pre>
<br>
Valid values for HeaderParameterName are: WordCharacters,BeginCharacters,EndCharacters,IgnoreFirstChar,IgnoreLastChar,Indexed on,Description,IndexPointer,IndexAdmin,Stemming,Soundex.<br>
<p>

<h3>char **SwishStopWords(struct SWISH *handle,char *filename, int *NumStops)</h3>
Returns an array containing all the stopwords stored in the index file pointed by filename (filename must match one of the names used in SwishOpen)<br>
On return NumStops contains the total number of stop words.<br>
<p>

<h3>char *SwishWords(struct SWISH *handle,char *filename, char c)</h3>
Returns a string containing all the words stored in the index file pointed by filename (filename must match one of the names used in SwishOpen) starting with c<br>
The returned string contains all the words delimited by the null char ('\0'). The last one is delimited by two consecutive 0<br>
<pre>
Eg:
char *keywords;
...
keywords=SwishWords(sw,"../tests/test.index",'t');
for(;keywords && keywords[0]; keywords+=strlen(keywords)+1)
{
	printf("%s ",keywords);
}
</pre>
<p>

<p>
<p>


<center>
<h2>Sample testlib.c</h2>
</center>

<pre>

#include ...

#include "swish.h"

int main()
{
struct SWISHE *sw;
int structure=IN_FILE;
int i,j,num_results,numPropertiesToDisplay;
struct result *r;

if(!(sw=SwishOpen("../tests/test.index")))
{
	printf("Could not open index files\n");
	exit(0);
}


/* You can execute several searchs without reopen the handles */
for(i=0;i<2000;i++) {

printf("---->Begin iteration %d\n",i);

num_results=SwishSearch(sw,"meta1=metatest1",structure,"meta1","meta2 asc");

if (num_results<0) 
{
	printf("Search error: %d\n",num_results);
	exit(0);
} else printf("Search results: %d\n",num_results);

numPropertiesToDisplay=getnumPropertiesToDisplay(sw);
while(r=SwishNext(sw))
{
   printf("%d %s \"%s\" %d %d",r->rank,r->filename,r->title,r->start,r->size);
   for(j=0;j<numPropertiesToDisplay;j++) printf(" \"%s\"",r->Prop[j]);
   printf("\n");
}

printf("---->End iteration %d\n",i);

}  /* for */

SwishClose(sw);


}
</pre>
</body>
</html>
